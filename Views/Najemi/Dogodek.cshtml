@model int
@using System.Globalization
@using TPO_Seminar.Models

@{
    var context = new UserContext();
    var studentId = Model;
    var unconfirmedList = context.Orders.Where(el => el.Approved == false && el.StudentId == studentId).Select(el => new { ime = context.UserDatas.Where(y => y.UserProfileId == el.Students.UserProfileId).FirstOrDefault().Name + " " + context.UserDatas.Where(y => y.UserProfileId == el.Students.UserProfileId).FirstOrDefault().LastName, predmet = el.Subjects.SubjectName, datumizvajanja = el.OrderDate, id = el.Id }).ToList().Select(el => new { ime = el.ime, predmet = el.predmet, datumizvajanja = el.datumizvajanja.ToString("dd.MM.yyyy"), id = el.id, ura = el.datumizvajanja.Hour });
    var confirmedList = context.Orders.Where(el => el.Approved && el.StudentId == studentId).Select(el => new { ime = context.UserDatas.Where(y => y.UserProfileId == el.Students.UserProfileId).FirstOrDefault().Name + " " + context.UserDatas.Where(y => y.UserProfileId == el.Students.UserProfileId).FirstOrDefault().LastName, predmet = el.Subjects.SubjectName, datumizvajanja = el.OrderDate, id = el.Id }).ToList().Select(el => new { ime = el.ime, predmet = el.predmet, datumizvajanja = el.datumizvajanja.ToString("dd.MM.yyyy"), id = el.id, ura = el.datumizvajanja.Hour });
    
}

<style>
    table {
        table-layout: fixed;
        word-wrap: break-word;
    }

    button {
        width: 80px;
    }
</style>

@if (confirmedList.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Ime študenta</th>
                    <th>Predmet</th>
                    <th>Datum izvajanja</th>
                    <th>Ura</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in confirmedList)
                {
                    <tr>
                        <td>
                            @item.ime
                        </td>
                        <td>@item.predmet</td>
                        <td>@item.datumizvajanja</td>
                        <td>@item.ura</td>
                        <td>
                            <button type="button" class="btn btn-default btn-xs" name="connectRow" value="@item.id" disabled>
                                <span class="glyphicon glyphicon-random" aria-hidden="true"></span>Poveži
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
<div class="panel panel-default">
    <div class="panel-heading">
        Dogodki
    </div>
    <div class="panel-body">
        Ni prihajajočih dogodkov.
    </div>

</div>
}

@section scripts{
    <script>
        $(document).ready(function () {
            $("button").click(function () {
                var val = $(this).attr("value");
                var formData = { Id: val };
                if ($(this).attr("name") == "deleteRow") {
                    $.ajax({
                        url: "DeleteOrder",
                        type: "POST",
                        data: formData,
                        success: function (data) {
                            $("body").html(data);
                        }
                    });
                }
            });
        });
    </script>
}